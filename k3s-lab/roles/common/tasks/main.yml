# common role tasks
- name: Install base packages
  apt:
    name:
      - ca-certificates
      - curl
      - gnupg
      - git
    update_cache: true
    state: present

- name: Install Python Kubernetes client
  apt:
    name: python3-kubernetes
    state: present


- name: Install Docker using official convenience script
  ansible.builtin.shell: |
    curl -fsSL https://get.docker.com | sh
  args:
    creates: /usr/bin/docker

- name: Ensure docker group membership
  user:
    name: "{{ ansible_user_id }}"
    groups: docker
    append: true

- name: Install kubectl
  ansible.builtin.shell: |
    curl -Lo /usr/local/bin/kubectl \
      https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
    chmod +x /usr/local/bin/kubectl
  args:
    creates: /usr/local/bin/kubectl

- name: Install Helm
  ansible.builtin.shell: |
    curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
  args:
    creates: /usr/local/bin/helm
